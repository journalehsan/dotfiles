# Optimizations for Intel Celeron N4000, 4GB RAM, eMMC storage with zram
# Place in /etc/sysctl.d/99-celeron-optimizations.conf

# === Memory Management ===
# Lower swappiness since we have zram (default 60 is too high)
vm.swappiness = 10

# Reduce cache pressure to keep more in memory (default 100)
vm.vfs_cache_pressure = 50

# Increase dirty ratio for better performance on eMMC (reduces writes)
vm.dirty_ratio = 40
vm.dirty_background_ratio = 20

# Increase writeback time for less frequent writes (eMMC longevity)
vm.dirty_writeback_centisecs = 3000
vm.dirty_expire_centisecs = 18000

# Better memory management for low RAM systems
vm.min_free_kbytes = 65536
vm.watermark_scale_factor = 200

# === Performance Tweaks ===
# Reduce swappiness for zram
vm.page-cluster = 0

# Improve responsiveness under memory pressure
vm.watermark_boost_factor = 0

# OOM killer tuning
vm.oom_kill_allocating_task = 1
vm.panic_on_oom = 0

# === Network (optional but helps) ===
net.core.netdev_max_backlog = 16384
net.ipv4.tcp_fastopen = 3

# === Scheduler ===
kernel.sched_autogroup_enabled = 1
